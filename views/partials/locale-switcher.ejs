<% const localeOptions = Array.isArray(availableLocales) && availableLocales.length ? availableLocales : [{ code: 'en', label: 'English' }]; %>
<% const safeLocaleCount = Math.max(1, localeOptions.length); %>
<% const activeLocaleIndex = Math.max(0, localeOptions.findIndex((entry) => entry.code === locale)); %>
<form class="locale-switcher" method="POST" action="/set-locale">
  <span class="sr-only" id="locale-switcher-label"><%= t('common.language') %></span>
  <input type="hidden" name="csrfToken" value="<%= csrfToken %>">
  <input type="hidden" name="returnTo" value="<%= currentPath %>">
  <div
    class="locale-toggle"
    role="group"
    aria-labelledby="locale-switcher-label"
    style="--locale-count:<%= safeLocaleCount %>; --active-index:<%= activeLocaleIndex %>;"
  >
    <% localeOptions.forEach((entry) => { %>
      <button
        type="submit"
        name="locale"
        value="<%= entry.code %>"
        class="locale-toggle__option <%= entry.code === locale ? 'is-active' : '' %>"
        aria-pressed="<%= entry.code === locale ? 'true' : 'false' %>"
      >
        <span><%= entry.label %></span>
      </button>
    <% }) %>
  </div>
</form>
